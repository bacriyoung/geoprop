# ==============================================================================
# Global Configuration (V3.0 Final - No Redundancy)
# ==============================================================================

project:
  name: "geoprop_v3_stable"
  seed: 42
  device: "cuda"
  target_dataset: "s3dis" # Links to config/s3dis/s3dis.yaml

train:
  enable: true
  epochs: 50
  batch_size: 8
  learning_rate: 0.001
  weight_decay: 0.0001
  
  # [V3.0 Features - Default OFF for V2.0 Compatibility]
  use_dynamic_weights: true
  
  seed_mode:
    train: false # False = Random (V2.0)
    val: false   # False = Random (V2.0)
  
  val_interval: 1
  val_mode: "block_proxy" 
  val_sample_batches: 100

  augmentation:
    enabled: true
    jitter_sigma: 0.001
    jitter_clip: 0.005
    rotate: true      # Random rotation around Z-axis
    scale: true       # Random scaling [0.8, 1.2]
    flip: true        # Random flipping (X/Y)

  loss_weights:
    boundary: 0.3

dataset:
  name: "s3dis"
  num_workers: 4
  # [Clean] label_ratio removed from here. It is fetched from s3dis.yaml by main.py

model:
  qk_dim: 128
  k_neighbors: 32
  # [V3.0 Feature]
  input_mode: "gblobs" #absolute or gblobs

inference:
  enable: true
  checkpoint_path: "/home/work/research/geoprop/outputs/s3dis/20260102_113104_GBL_TR-Rnd-Fix_INF-Prod/last_model.pth" 
  save_img: true
  save_npy: true
  vis_downsample: 60000
  ablation_mode: false

  direct_inference:
    save_output: true

  tta:
    enabled: true
    rounds: 5
    jitter: 0.005 
    aggressive: true # [V3.1 Update] Enable rotation voting (0, 90, 180, 270)
    save_output: true

  confidence_filter:
    enabled: false
    rec_err_strict: 0.08
    rec_err_loose: 0.15
    save_output: false

  geometric_gating:
    enabled: true
    voxel_n: 400
    weights: {rgb: 15.0, xyz: 1.0}
    gate_strength: 5.0
    confidence_threshold: 0.65
    save_output: false

  graph_refine:
    enabled: true
    fine_voxel_n: 80
    fine_weight_xyz: 10.0
    k_neighbors: 8
    confidence_threshold: 0.65
    save_output: false

  spatial_smooth:
    enabled: true
    k_neighbors: 32
    save_output: true